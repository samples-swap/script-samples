{
  name : "utils",
  text : "PACKAGE \"UTILS\" is\n\n  -- Author  : DANIEL\n  -- Created : 21/11/2002 19:10:21\n\n  function days_plus(inicial in date, qtd in integer) return tab_days;\n  function days_month(inicial in date) return tab_days;\n  procedure comp_estoque(ano in integer, mes in integer);\n  function inc_sequence(seq_name varchar2, qtd in number) return tnumber;\nend utils;\n\n ",
  body : "PACKAGE BODY \"UTILS\" is\n\n  function days_plus(inicial in date, qtd in integer) return tab_days is\n    Result tab_days;\n  begin\n    Result := tab_days(inicial);\n    Result.extend(qtd);\n    for i in 1 .. qtd loop\n      Result(i + 1) := inicial + i;\n    end loop;\n    return(Result);\n  end days_plus;\n\n  function days_month(inicial in date) return tab_days is\n  begin\n    return days_plus(trunc(inicial,'month'), last_day(inicial) - trunc(inicial,'month') );\n  end days_month;\n\n  procedure comp_estoque(ano in integer, mes in integer) is\n    ano_mes string(10);\n    sql_msg string(100);\n  begin\n    ano_mes := trim(to_char(ano, '0000')) ||'_' || trim(to_char(mes, '00'));  -- a definir o mes\n\n    sql_msg := 'alter table movimento_estoque modify partition MOVIMENTO_' || ano_mes || ' compress';\n    execute immediate sql_msg;\n\n    sql_msg := 'alter table movimento_estoque move partition MOVIMENTO_' || ano_mes || ' update global indexes';\n    execute immediate sql_msg;\n\n    sql_msg := 'alter index me_data rebuild partition MOVIMENTO_' || ano_mes;\n    execute immediate sql_msg;\n\n    sql_msg := 'alter index ME_FORNDIV_BM rebuild partition MOVIMENTO_' || ano_mes;\n    execute immediate sql_msg;\n\n    sql_msg := 'alter index ME_LOJA_BM rebuild partition MOVIMENTO_' || ano_mes;\n    execute immediate sql_msg;\n\n    sql_msg := 'alter index ME_PROD_BM rebuild partition MOVIMENTO_' || ano_mes;\n    execute immediate sql_msg;\n\n    sql_msg := 'alter index ME_SETOR_BM rebuild partition MOVIMENTO_' || ano_mes;\n    execute immediate sql_msg;\n\n    sql_msg := 'alter index ME_TIPO_BM rebuild partition MOVIMENTO_' || ano_mes;\n    execute immediate sql_msg;\n\n    sql_msg := 'analyze table movimento_estoque partition (MOVIMENTO_' || ano_mes || ') compute statistics';\n    execute immediate sql_msg;\n\n    sql_msg := 'analyze index me_data partition (MOVIMENTO_' || ano_mes || ') compute statistics';\n    execute immediate sql_msg;\n\n    sql_msg := 'analyze index ME_FORNDIV_BM partition (MOVIMENTO_' || ano_mes || ') compute statistics';\n    execute immediate sql_msg;\n\n    sql_msg := 'analyze index ME_LOJA_BM partition (MOVIMENTO_' || ano_mes || ') compute statistics';\n    execute immediate sql_msg;\n\n    sql_msg := 'analyze index ME_PROD_BM partition (MOVIMENTO_' || ano_mes || ') compute statistics';\n    execute immediate sql_msg;\n\n    sql_msg := 'analyze index ME_SETOR_BM partition (MOVIMENTO_' || ano_mes || ') compute statistics';\n    execute immediate sql_msg;\n\n    sql_msg := 'analyze index ME_TIPO_BM partition (MOVIMENTO_' || ano_mes || ') compute statistics';\n    execute immediate sql_msg;\n  end comp_estoque;\n\n  function inc_sequence(seq_name varchar2, qtd in number) return tnumber is\n    v_tnumber tnumber;\n    v_key number;\n    v_sql varchar(200);\n  begin\n    v_tnumber := tnumber();\n    v_tnumber.extend(qtd);\n    v_sql := 'select ' || seq_name || '.nextval from dual';\n    for i in 1..qtd loop\n      execute immediate v_sql into v_key;\n      v_tnumber(i) := v_key;\n    end loop;\n\n    return v_tnumber;\n  end;\n\nend utils;\n"
}
